# SPDX-License-Identifier: MIT-0
---
- name: Enable status module
  ansible.builtin.command:
    cmd: a2enmod status
  register: apache_enable_status_module_result
  changed_when: "'Enabling module' in apache_enable_status_module_result.stdout"
  when: apache_status_page_enabled
  notify: Reload apache

- name: Create status page configuration
  ansible.builtin.template:
    src: status.conf.j2
    dest: /etc/apache2/conf-available/status.conf
    mode: "0644"
  when: apache_status_page_enabled
  notify: Reload apache

- name: Enable status page configuration
  ansible.builtin.command:
    cmd: a2enconf status
  register: apache_enable_status_conf_result
  changed_when: "'Enabling conf' in apache_enable_status_conf_result.stdout"
  when: apache_status_page_enabled
  notify: Reload apache

- name: Disable status page configuration
  ansible.builtin.command:
    cmd: a2disconf status
  register: apache_disable_status_conf_result
  changed_when:
    - "'Conf' in apache_disable_status_conf_result.stdout"
    - "'disabled' in apache_disable_status_conf_result.stdout"
  when: not apache_status_page_enabled
  notify: Reload apache

- name: Remove status page configuration
  ansible.builtin.file:
    path: /etc/apache2/conf-available/status.conf
    state: absent
  when: not apache_status_page_enabled
  notify: Reload apache

# SPDX-License-Identifier: MIT-0
---
- name: Verify PHP binary exists
  ansible.builtin.stat:
    path: "/usr/bin/php{{ php_version }}"
  register: php_binary_check
  failed_when: not php_binary_check.stat.exists
  when: not ansible_check_mode

- name: Check current default PHP CLI version
  ansible.builtin.command: php --version
  register: php_current_version
  changed_when: false
  failed_when: false

- name: Set all PHP CLI tools as default for version {{ php_version }}
  community.general.alternatives:
    name: "{{ item }}"
    path: "/usr/bin/{{ item }}{{ php_version }}"
    state: selected
  loop:
    - php
    - phar
    - phar.phar
    - phpize
    - php-config
  when: >
    php_cli_set_as_default_version and
    (php_current_version.stdout is not defined or
    php_version not in php_current_version.stdout) and
    (('/usr/bin/php' ~ php_version is file) | bool)

// For format details, see https://aka.ms/devcontainer.json.
{
	"name": "ansible-dev-tools-ubuntu",
	"image": "mcr.microsoft.com/devcontainers/base:noble",
	"features": {
    "ghcr.io/devcontainers/features/python:1": {},
    "ghcr.io/devcontainers-extra/features/pipx-package:1": {
      "includeDeps": true,
      "package": "ansible-dev-tools",
      "version": "latest",
      "injections": "molecule-plugins[docker]"
    },
    "ghcr.io/wxw-matt/devcontainer-features/script_runner:0": {},
		"ghcr.io/devcontainers/features/docker-outside-of-docker:1": {},
    "ghcr.io/stuartleeks/dev-container-features/shell-history:0": {},
    "ghcr.io/dhoeric/features/act:1": {},
    "ghcr.io/devcontainers/features/node:1": {
      "version": "latest"
    }
	},
  "postCreateCommand": {
    "install-galaxy-dependencies": "ansible-galaxy collection install community.docker community.general ansible.posix",
    "set-act-settings": "echo '-P ubuntu-latest=ghcr.io/catthehacker/ubuntu:act-latest\\n-P ubuntu-24.04=ghcr.io/catthehacker/ubuntu:act-24.04-20250915\\n-P ubuntu-22.04=ghcr.io/catthehacker/ubuntu:act-22.04' >> ~/.actrc",
    "install-gemini": "npm install -g @google/gemini-cli"
  },
  "mounts": [
    // "source=/home/yurgenlira/.docker/desktop/docker.sock,target=/var/run/docker.sock,type=bind",
    "source=/home/yurgenlira/.gemini,target=/root/.gemini,type=bind,consistency=cached"
  ],
  "runArgs": [
    "--security-opt",
    "seccomp=unconfined",
    "--security-opt",
    "label=disable",
    "--cap-add=SYS_ADMIN",
    "--cap-add=SYS_RESOURCE",
    "--device",
    "/dev/fuse",
    "--security-opt",
    "apparmor=unconfined",
    "--hostname=ansible-dev-container"
  ],
  "updateRemoteUserUID": true,
  "customizations": {
    "vscode": {
      "extensions": [
        "redhat.ansible",
        "redhat.vscode-redhat-account",
        "samuelcolvin.jinjahtml",
        "SanjulaGanepola.github-local-actions",
        "google.gemini-cli-vscode-ide-companion"
        // # There is a bug, don't allow to connect to gemini cli inside a devcontainer because it use a dynamic port
        // # and the devcontainer don't forward it
      ],
      "settings": {
        "files.insertFinalNewline": true,
        "files.trimTrailingWhitespace": true
      }
    }
  },
  "remoteUser": "root"
}
